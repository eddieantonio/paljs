/*!Pal.JS: 2013 (C) Eddie Antonio Santos. MIT license.*/
(function(){var compile,makeButtonBar,makeInputFetcher,makeOutputter,preventDefault,timeIt;preventDefault=function(a){return function(b){return b.preventDefault(),a.apply(this,arguments)}},timeIt=function(a){var b,c;return c=performance.now(),a(),b=performance.now(),b-c},makeButtonBar=function(a,b){var c,d;return c=a.find("a[data-panel]"),d=b.find(".output"),c.on("click",preventDefault(function(){var a,b,e;return b=$(this),e=b.data("panel"),c.removeClass("active"),d.removeClass("active"),a=$("#"+e),a.addClass("active"),b.addClass("active")}))},compile=function(a,b){var c,d,e;return d=a(),e=null,c=timeIt(function(){return e=PalCompiler(d)}),e.time=c,b(e)},makeInputFetcher=function(a){return function(){return a.val()}},makeOutputter=function(elements,$eventSource){var $ast,$console,$js,makeRunnableProgram,newConsoleLine,rebindRunner,showError,updatePlainTextDisplay,writeln;return $console=elements[0],$js=elements[1],$ast=elements[2],newConsoleLine=function(a,b){var c,d;return null==b&&(b=""),c=$console.find(".console-lines"),d=$("<li>").text(a),c.append(d),c.parent().scrollTop(c.height()),d},updatePlainTextDisplay=function(a,b){return a.find("pre > code").text(b)},showError=function(a){var b;return b=newConsoleLine(a),b.addClass("error")},writeln=function(){var a,b;return b=_.toArray(arguments),a=_(b).map(function(a){return a+""}).join(""),newConsoleLine(a)},makeRunnableProgram=function(src){var fn;return fn=eval(src),function(){return fn(null,writeln)}},rebindRunner=function(a){var b;return b=makeRunnableProgram(a),$eventSource.off("paljs:run"),$eventSource.on("paljs:run",function(){return b()})},function(a){var b;return null!=a.error?(showError(a.error.toString()),void 0):(updatePlainTextDisplay($js,a.src),updatePlainTextDisplay($ast,JSON.stringify(a.ast,null,2)),rebindRunner(a.src),b=newConsoleLine("Compiled in "+a.time+"ms"),b.addClass("info"))}},$(function(){var a,b,c,d,e,f,g,h;return c=$("#pal-program"),b=$("#console"),a=$("#ast"),d=$("#js"),e=$('a[href="#!run"]'),g=makeInputFetcher(c),h=makeOutputter([b,d,a],e),f=_.debounce(function(){return compile(g,h)},500),makeButtonBar($(".output-selector"),$(".output-wrapper")),c.on("input copy cut paste change",function(){return f()}),e.on("click",preventDefault(function(){return $(this).trigger("paljs:run")})),c.trigger("change")})}).call(this);